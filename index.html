<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>貸款利息計算器</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>貸款利息計算器</h1>
  <form>
    <label for="">試算方式: </label>
    <input type="radio" name="repayment" id="principalPayment" checked>本金攤還
    <input type="radio" name="repayment" id="insterestPayment">本息攤還
    <br>
    <label for="loanAmount">貸款金額: </label>
    <input type="number" id="loanAmount" placeholder="請輸入金額" value="10">&nbsp;萬
    <br>
    <label for="insterestRate">貸款利率: </label>
    <input type="number" id="insterestRate" step="0.1" value="3.5">&nbsp;%
    <br>
    <label for="loanYear">貸款年數: </label>
    <select name="loanYear" id="loanYear">
      <option value="3">3</option>
      <option value="5">5</option>
      <option value="7" selected>7</option>
      <option value="10">10</option>
      <option value="20">20</option>
    </select>年
    <!-- <input type="text" /> -->
    <!-- 練習:有輸入自訂期數已input為主 -->
    <br>
    <br>
    <input type="button" value="計算" onclick="roanCalc()">
  </form>
  <div id="result"></div>
  <table border="1" id="resultTable" hidden>
    <thead>
      <tr>
        <th>期別</th>
        <th>本金</th>
        <th>利息</th>
        <th>本利和</th>
        <th>餘額</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const loanAmountEl = document.querySelector("#loanAmount");
    const insterestRateEl = document.querySelector("#insterestRate");
    const loanYearEl = document.querySelector("#loanYear");
    const principalPaymentEl = document.querySelector("#principalPayment");

    const resultEl = document.querySelector("#result");

    const tableTbodyEl = document.querySelector("#resultTable>tbody");

    function roanCalc() {  //處理邏輯
      let loanAmount = loanAmountEl.value * 10000;
      let insterestRate = insterestRateEl.value;
      let loanYear = loanYearEl.value;
      let principalPayment = principalPaymentEl.checked;

      let amount = loanAmount;
      let months = loanYear * 12;
      let monthRate = insterestRate / 100 / 12;

      let monthPay = parseInt(amount / months);
      let resultPayment = [];

      console.log(amount, monthRate, months, monthPay);
      for (let i = 0; i < months; i++) {
        let interest = Math.round(amount * monthRate);
        amount -= monthPay;
        let text = "";
        if (i == months - 1) {
          resultPayment.push([i + 1, monthPay + amount, interest, monthPay + interest + amount, 0]);
        } else {
          resultPayment.push([i + 1, monthPay, interest, monthPay + interest, amount]);
        };
      };
      let totalInterest = 0;
      for (let i = 0; i < resultPayment.length; i++) {
        totalInterest += resultPayment[i][2];
      };
      resultEl.innerHTML = `期數: ${resultPayment.length} 總利息支出: ${totalInterest} 總還款金額: ${amount + totalInterest}`;
      drawTable(resultPayment);
    };

    function drawTable(resultPayment) {  //負責繪製(table)
      let tableHtml = "";
      for (let i = 0; i < resultPayment.length; i++) {
        tableHtml += `<tr>`;
        for (let j = 0; j < resultPayment[i].length; j++) {
          tableHtml += `<td>${resultPayment[i][j]}</td>`;
        };
        tableHtml += `</tr>`;
      }
      if (tableHtml != '') {
        document.querySelector("#resultTable").style.display = 'table';
      }
      tableTbodyEl.innerHTML = tableHtml;
    };
  </script>
</body>

</html>